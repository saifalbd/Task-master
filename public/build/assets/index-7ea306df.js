import{A as T,_ as E}from"./PageTitleBox-9be017fa.js";import{F as j,r as S,u as z}from"./index-6f6f3ed4.js";import"./moment-fbc5633a.js";import{_ as L,r as v,o as w,g as B,h as f,j as _,a as o,i as u,d as N,b as x,c as V,k as O,F as Z,s as P,t as F,p as D,l as U,V as A,N as G,O as a,C as J,f as K,q as Q,A as W}from"./app-fb8c1635.js";import{m as $}from"./icon-7c2f508c.js";import{C as I}from"./index-3437df1a.js";const X={components:{FormDialog:j},props:{show:{type:Boolean,default:!1},taskId:{type:Number,required:!0},parent:{type:Object,required:!0}},setup(t,{emit:s}){let m=v(!1);const e=v(null);let i=v("");return{props:t,form:e,emit:s,save:async()=>{if(route("task.store"),!await e.value.validate())return null;try{const l=new FormData,p=route("comment.store");l.append("model_id",t.taskId),l.append("model_type","task"),l.append("parent_id",t.parent.id),l.append("text",i.value);const{data:d}=await axios.post(p,l);i.value="",s("update:show",!1)}catch(l){console.error(l),validErorrs(l)}},rs:S,busy:m,text:i}}},Y={class:"layout gutter--md"},tt={class:"row align-content--center"},et={class:"flex xs12 in-box"};function ot(t,s,m,e,i,r){const c=u("va-input"),l=u("va-form"),p=u("form-dialog");return w(),B(p,{show:e.props.show,"onUpdate:show":s[1]||(s[1]=d=>e.emit("update:show",d)),busy:e.busy,title:"Replay",onAdd:e.save,fullscreen:!1},{default:f(()=>[_(l,{ref:"form"},{default:f(()=>[o("div",Y,[o("div",tt,[o("div",et,[_(c,{modelValue:e.text,"onUpdate:modelValue":s[0]||(s[0]=d=>e.text=d),label:"Replay",type:"textarea",placeholder:"Commnet Here",rules:e.rs("Replay",!0)},null,8,["modelValue","rules"])])])])]),_:1},512)]),_:1},8,["show","busy","onAdd"])}const R=L(X,[["render",ot]]);const st=N({props:{show:{type:Boolean,default:!1},attachments:{type:Array,default(){return[]}}},setup(t,{emit:s}){return{props:t,close:()=>{s("update:show",!1)}}}}),at=t=>(D("data-v-4d76b8f1"),t=t(),U(),t),nt={class:"layout va-gutter-1"},lt={class:"row"},dt={class:"flex xs12"},rt={class:"item mb-4"},it={class:"form-title"},ct=at(()=>o("span",{class:"text"},"Attachments",-1)),mt={class:"flex xs12"},_t={class:"item"},ut={class:"row"},pt=["src","alt"],ht={key:1},vt=["href"],ft={class:"flex xs12"},yt={class:"item actions-btns"};function wt(t,s,m,e,i,r){const c=u("va-icon"),l=u("va-button"),p=u("va-modal");return w(),B(p,{modelValue:t.show,"onUpdate:modelValue":s[0]||(s[0]=d=>t.show=d),fullscreen:!1,"hide-default-actions":"","no-outside-dismiss":""},{default:f(()=>[o("div",nt,[o("div",lt,[o("div",dt,[o("div",rt,[o("div",it,[_(c,{class:"material-icons"},{default:f(()=>[x("file_present")]),_:1}),ct])])]),o("div",mt,[o("div",_t,[o("div",ut,[(w(!0),V(Z,null,O(t.props.attachments,d=>(w(),V("div",{class:"flex sm12",key:d.id},[d.isImg?(w(),V("div",{key:0,class:P({is_img:d.isImg})},[o("img",{src:d.url,alt:d.path},null,8,pt)],2)):(w(),V("div",ht,[o("a",{href:d.url},F(d.path),9,vt)]))]))),128))])])]),o("div",ft,[o("div",yt,[_(l,{color:"danger",size:"small",onClick:t.close},{default:f(()=>[_(c,{class:"material-icons"},{default:f(()=>[x("close")]),_:1}),x(" Close")]),_:1},8,["onClick"])])])])])]),_:1},8,["modelValue"])}const H=L(st,[["render",wt],["__scopeId","data-v-4d76b8f1"]]),Vt=N({components:{VaAvatar:A,AddReplay:R,VaButtonGroup:G,ShowAttachment:H},props:{taskId:{type:Number,required:!0},comments:{type:Array,required:!0}},setup(t){return{props:t,remove:async(m,e)=>{try{const i=route("comment.destroy",{comment:m});await axios.delete(i);const r=e.findIndex(c=>c.id==m);r>-1&&e.splice(r,1)}catch(i){console.error(i)}}}},methods:{icon(t){let s=18;return a("svg",{style:`width:${s}px;height:${s}px`,viewBox:"0 0 24 24"},[a("path",{fill:"currentColor",d:t})])},commentItemField(t,s){var i;let m=a("div");return t.replayes.length&&(m=a("div",{class:"comment-list"},t.replayes.map(r=>this.commentItemField(r,r.replayes)))),a("div",{class:"comment-list-item"},[a("div",{class:"inner"},[a("div",{},[a(A,{src:"https://randomuser.me/api/portraits/women/5.jpg"})]),a("div",{class:"text-box"},[a("p",{},[a("b",{},t.user.name),a("small",t.atNow)]),a("p",{},t.text)])]),a("div",{class:"action-bar"},[a(R,{show:t.showReplay,parent:t,taskId:this.props.taskId,"onUpdate:show":r=>{t.showReplay=r},onPush:r=>{t.replayes.push(r),t.showReplay=!1}}),a("div",{class:"action-bar-inner"},[a("div",{class:"action-list"},[a("button",{class:"like-btn"},[this.icon("M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z")]),a("button",{class:"replay-btn",onClick:()=>{t.showReplay=!0}},[this.icon("M11,9.8V10.7L12.7,10.9C15.3,11.3 17.2,12.3 18.6,13.6C16.9,13.1 15.1,12.8 13,12.8H11V14.1L8.8,12L11,9.8M13,5L6,12L13,19V14.9C18,14.9 21.5,16.5 24,20C23,15 20,10 13,9M7,8V5L0,12L7,19V16L3,12"),"Replay"]),a("button",{class:"remove-btn",onClick:()=>{this.remove(t.id,s)}},[this.icon("M4 19V7H16V19C16 20.1 15.1 21 14 21H6C4.9 21 4 20.1 4 19M6 9V19H14V9H6M13.5 4H17V6H3V4H6.5L7.5 3H12.5L13.5 4M19 17V15H21V17H19M19 13V7H21V13H19Z"),"Remove"])]),(i=t.attachments)!=null&&i.length?a("div",{},[a(H,{attachments:t.attachments,show:t.showAttachModal,"onUpdate:show":r=>{t.showAttachModal=r}}),a("button",{class:"show-attach-btn",onClick:()=>{t.showAttachModal=!0}},[this.icon("M4 19V7H16V19C16 20.1 15.1 21 14 21H6C4.9 21 4 20.1 4 19M6 9V19H14V9H6M13.5 4H17V6H3V4H6.5L7.5 3H12.5L13.5 4M19 17V15H21V17H19M19 13V7H21V13H19Z"),"Show Attach"])]):a("div")])]),m])}},render(){return a("div",{class:"comment-list"},this.props.comments.map(t=>this.commentItemField(t,this.props.comments)))}});const bt={props:{auth_id:{type:Number,required:!0},id:{type:[String,Number],required:!0},task:{type:Object,required:!0}},components:{AppLayout:T,PageTitleBox:E,Comments:Vt,ShowAttachment:H},setup(t){const{init:s}=z(),m=v(null),e=v(t.task),i=v([]),r=v(!1),c=v(""),l=v([]),p=v(!1);J(t.task,h=>{e.value=h});const d=async h=>{try{const n=route("comment.index",{model_type:"task",model_id:t.id}),{data:y}=await axios.get(n);y.forEach(b=>{let g={comment:b,model_type:"task",model_id:t.id,auth_id:t.auth_id},q=new I(g);$(h,q)})}catch(n){console.error(n)}},k=h=>{try{window.Echo.join(`comment.task.${t.id}`).listen("NewComment",n=>{let y={comment:n,model_type:"task",model_id:t.id,auth_id:t.auth_id},b=new I(y);$(h,b),console.log("comment:"+n.text)})}catch(n){console.log(n)}};return K(()=>{let h=document.getElementById("commentListRoot");d(h),k(h)}),{rs:S,showAttachModal:r,commentBusy:p,task:e,addComment:async()=>{if(!c.value)return null;p.value=!0;try{const n=route("comment.store"),y=new FormData;y.append("model_id",t.id),y.append("model_type","task"),y.append("text",c.value),l.value.forEach((b,g)=>{y.append(`attachments[${g}]`,b)}),await axios.post(n,y),c.value="",s({message:"Succsess Fully Add Comment",color:"#432c50",closeable:!0,duration:2e3}),m.value.reset()}catch(n){console.error(n)}p.value=!1},comments:i,comment:c,attachments:l}}},C=t=>(D("data-v-1a5d65d7"),t=t(),U(),t),xt={class:"task-show"},Ct={class:"top-part"},kt={key:0,class:"mt-3"},gt=C(()=>o("h1",null,"Right Info",-1)),Ht={class:"description"},Lt=C(()=>o("b",null,"Description:",-1)),Mt=["innerHTML"],At={class:"comment-layout",id:"commentLayout"},$t={class:"row"},It=C(()=>o("div",{class:"flex sm12 mb-3"},[o("div",{class:"comment-list",id:"commentListRoot"})],-1)),Rt={class:"flex sm12"},St={class:"textarea-bottom"},Bt={class:"left-side"},Nt={class:"right"},Ft=C(()=>o("span",{class:"ml-2"},"Add Comment",-1));function Dt(t,s,m,e,i,r){const c=u("show-attachment"),l=u("va-button"),p=u("va-input"),d=u("va-file-upload"),k=u("va-icon"),M=u("va-form"),h=u("va-inner-loading");return w(),V("div",xt,[_(c,{attachments:e.task.attachments,show:e.showAttachModal,"onUpdate:show":s[0]||(s[0]=n=>e.showAttachModal=n)},null,8,["attachments","show"]),o("div",Ct,[o("div",null,[o("h1",null,F(e.task.title),1),e.task.attachments.length?(w(),V("div",kt,[_(l,{preset:"primary",icon:"file_present",onClick:s[1]||(s[1]=n=>e.showAttachModal=!0)},{default:f(()=>[x("Show Attachments")]),_:1})])):Q("",!0)]),W(t.$slots,"default",{},()=>[gt],!0)]),o("div",Ht,[Lt,x(),o("span",{innerHTML:e.task.description},null,8,Mt)]),o("div",At,[o("div",$t,[It,o("div",Rt,[_(h,{loading:e.commentBusy},{default:f(()=>[_(M,{class:"comment-form"},{default:f(()=>[_(p,{modelValue:e.comment,"onUpdate:modelValue":s[2]||(s[2]=n=>e.comment=n),type:"textarea",label:"Comments","min-rows":3,"max-rows":5,rules:e.rs("comment",!0)},null,8,["modelValue","rules"]),o("div",St,[o("div",Bt,[_(d,{class:"small","upload-button-text":"Upload Attachment",modelValue:e.attachments,"onUpdate:modelValue":s[3]||(s[3]=n=>e.attachments=n),dropzone:""},null,8,["modelValue"])]),o("div",Nt,[_(l,{preset:"secondary","border-color":"primary",onClick:e.addComment},{default:f(()=>[_(k,{name:"comment"}),Ft]),_:1},8,["onClick"])])])]),_:1})]),_:1},8,["loading"])])])])])}const Ot=L(bt,[["render",Dt],["__scopeId","data-v-1a5d65d7"]]);export{Ot as S};
