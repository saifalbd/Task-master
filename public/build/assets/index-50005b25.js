import{a as O}from"./app-layout-ddd4ecde.js";import{_ as Z}from"./PageTitleBox-3291f9d9.js";import{F as P}from"./FormDialog-0d177dd5.js";import{r as N}from"./index-810449cf.js";import"./moment-fbc5633a.js";import{_ as $,r as g,f as y,h as H,w as d,b as i,i as o,e as m,d as q,j as x,c as b,p as T,F as U,K as G,t as A,q as E,s as j,ae as R,af as J,ag as a,al as K,O as Q,M as W,J as X,H as Y,g as tt,k as et}from"./app-15300521.js";import{m as B}from"./icon-7c2f508c.js";import{C as D}from"./index-3f9f24ef.js";import{u as ot}from"./useToast-c3bf6ae8.js";const st={components:{FormDialog:P},props:{show:{type:Boolean,default:!1},taskId:{type:Number,required:!0},parent:{type:Object,required:!0}},setup(t,{emit:s}){let p=g(!1);const e=g(null);let _=g("");return{props:t,form:e,emit:s,save:async()=>{if(route("task.store"),!await e.value.validate())return null;try{const n=new FormData,f=route("comment.store");n.append("model_id",t.taskId),n.append("model_type","task"),n.append("parent_id",t.parent.id),n.append("text",_.value);const{data:l}=await axios.post(f,n);_.value="",s("update:show",!1)}catch(n){console.error(n),validErorrs(n)}},rs:N,busy:p,text:_}}},at={class:"layout gutter--md"},nt={class:"row align-content--center"},lt={class:"flex xs12 in-box"};function rt(t,s,p,e,_,c){const u=m("va-input"),n=m("va-form"),f=m("form-dialog");return y(),H(f,{show:e.props.show,"onUpdate:show":s[1]||(s[1]=l=>e.emit("update:show",l)),busy:e.busy,title:"Replay",onAdd:e.save,fullscreen:!1},{default:d(()=>[i(n,{ref:"form"},{default:d(()=>[o("div",at,[o("div",nt,[o("div",lt,[i(u,{modelValue:e.text,"onUpdate:modelValue":s[0]||(s[0]=l=>e.text=l),label:"Replay",type:"textarea",placeholder:"Commnet Here",rules:e.rs("Replay",!0)},null,8,["modelValue","rules"])])])])]),_:1},512)]),_:1},8,["show","busy","onAdd"])}const F=$(st,[["render",rt]]);const it=q({props:{show:{type:Boolean,default:!1},attachments:{type:Array,default(){return[]}}},setup(t,{emit:s}){return{props:t,close:()=>{s("update:show",!1)}}}}),dt=t=>(E("data-v-4d76b8f1"),t=t(),j(),t),ct={class:"layout va-gutter-1"},mt={class:"row"},_t={class:"flex xs12"},ut={class:"item mb-4"},pt={class:"form-title"},ht=dt(()=>o("span",{class:"text"},"Attachments",-1)),ft={class:"flex xs12"},vt={class:"item"},yt={class:"row"},wt=["src","alt"],gt={key:1},Vt=["href"],bt={class:"flex xs12"},Ct={class:"item actions-btns"};function xt(t,s,p,e,_,c){const u=m("va-icon"),n=m("va-button"),f=m("va-modal");return y(),H(f,{modelValue:t.show,"onUpdate:modelValue":s[0]||(s[0]=l=>t.show=l),fullscreen:!1,"hide-default-actions":"","no-outside-dismiss":""},{default:d(()=>[o("div",ct,[o("div",mt,[o("div",_t,[o("div",ut,[o("div",pt,[i(u,{class:"material-icons"},{default:d(()=>[x("file_present")]),_:1}),ht])])]),o("div",ft,[o("div",vt,[o("div",yt,[(y(!0),b(U,null,T(t.props.attachments,l=>(y(),b("div",{class:"flex sm12",key:l.id},[l.isImg?(y(),b("div",{key:0,class:G({is_img:l.isImg})},[o("img",{src:l.url,alt:l.path},null,8,wt)],2)):(y(),b("div",gt,[o("a",{href:l.url},A(l.path),9,Vt)]))]))),128))])])]),o("div",bt,[o("div",Ct,[i(n,{color:"danger",size:"small",onClick:t.close},{default:d(()=>[i(u,{class:"material-icons"},{default:d(()=>[x("close")]),_:1}),x(" Close")]),_:1},8,["onClick"])])])])])]),_:1},8,["modelValue"])}const I=$(it,[["render",xt],["__scopeId","data-v-4d76b8f1"]]),kt=q({components:{VaAvatar:R,AddReplay:F,VaButtonGroup:J,ShowAttachment:I},props:{taskId:{type:Number,required:!0},comments:{type:Array,required:!0}},setup(t){return{props:t,remove:async(p,e)=>{try{const _=route("comment.destroy",{comment:p});await axios.delete(_);const c=e.findIndex(u=>u.id==p);c>-1&&e.splice(c,1)}catch(_){console.error(_)}}}},methods:{icon(t){let s=18;return a("svg",{style:`width:${s}px;height:${s}px`,viewBox:"0 0 24 24"},[a("path",{fill:"currentColor",d:t})])},commentItemField(t,s){var _;let p=a("div");return t.replayes.length&&(p=a("div",{class:"comment-list"},t.replayes.map(c=>this.commentItemField(c,c.replayes)))),a("div",{class:"comment-list-item"},[a("div",{class:"inner"},[a("div",{},[a(R,{src:"https://randomuser.me/api/portraits/women/5.jpg"})]),a("div",{class:"text-box"},[a("p",{},[a("b",{},t.user.name),a("small",t.atNow)]),a("p",{},t.text)])]),a("div",{class:"action-bar"},[a(F,{show:t.showReplay,parent:t,taskId:this.props.taskId,"onUpdate:show":c=>{t.showReplay=c},onPush:c=>{t.replayes.push(c),t.showReplay=!1}}),a("div",{class:"action-bar-inner"},[a("div",{class:"action-list"},[a("button",{class:"like-btn"},[this.icon("M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z")]),a("button",{class:"replay-btn",onClick:()=>{t.showReplay=!0}},[this.icon("M11,9.8V10.7L12.7,10.9C15.3,11.3 17.2,12.3 18.6,13.6C16.9,13.1 15.1,12.8 13,12.8H11V14.1L8.8,12L11,9.8M13,5L6,12L13,19V14.9C18,14.9 21.5,16.5 24,20C23,15 20,10 13,9M7,8V5L0,12L7,19V16L3,12"),"Replay"]),a("button",{class:"remove-btn",onClick:()=>{this.remove(t.id,s)}},[this.icon("M4 19V7H16V19C16 20.1 15.1 21 14 21H6C4.9 21 4 20.1 4 19M6 9V19H14V9H6M13.5 4H17V6H3V4H6.5L7.5 3H12.5L13.5 4M19 17V15H21V17H19M19 13V7H21V13H19Z"),"Remove"])]),(_=t.attachments)!=null&&_.length?a("div",{},[a(I,{attachments:t.attachments,show:t.showAttachModal,"onUpdate:show":c=>{t.showAttachModal=c}}),a("button",{class:"show-attach-btn",onClick:()=>{t.showAttachModal=!0}},[this.icon("M4 19V7H16V19C16 20.1 15.1 21 14 21H6C4.9 21 4 20.1 4 19M6 9V19H14V9H6M13.5 4H17V6H3V4H6.5L7.5 3H12.5L13.5 4M19 17V15H21V17H19M19 13V7H21V13H19Z"),"Show Attach"])]):a("div")])]),p])}},render(){return a("div",{class:"comment-list"},this.props.comments.map(t=>this.commentItemField(t,this.props.comments)))}});const Ht={props:{auth_id:{type:[String,Number],required:!0},id:{type:[String,Number],required:!0},task:{type:Object,required:!0}},components:{AppLayout:O,PageTitleBox:Z,Comments:kt,ShowAttachment:I,ArrowRightBold:K},setup(t){const{init:s}=ot(),p=g(null),e=g(t.task),_=g([]),c=g(!1),u=g(""),n=g([]),f=g(!1);Q(t.task,h=>{e.value=h});const l=async h=>{try{const r=route("comment.index",{model_type:"task",model_id:t.id}),{data:v}=await axios.get(r);v.forEach(V=>{let k={comment:V,model_type:"task",model_id:t.id,auth_id:t.auth_id},w=new D(k);B(h,w)})}catch(r){console.error(r)}},C=h=>{try{window.Echo.join(`comment.task.${t.id}`).listen("NewComment",r=>{let v={comment:r,model_type:"task",model_id:t.id,auth_id:t.auth_id},V=new D(v);B(h,V),console.log("comment:"+r.text)})}catch(r){console.log(r)}};return W(()=>{let h=document.getElementById("commentListRoot");l(h),C(h)}),{rs:N,showAttachModal:c,commentBusy:f,task:e,addComment:async()=>{if(!u.value)return null;f.value=!0;try{const r=route("comment.store"),v=new FormData;v.append("model_id",t.id),v.append("model_type","task"),v.append("text",u.value),n.value.forEach((V,k)=>{v.append(`attachments[${k}]`,V)}),await axios.post(r,v),u.value="",s({message:"Succsess Fully Add Comment",color:"#432c50",closeable:!0,duration:2e3}),p.value.reset()}catch(r){console.error(r)}f.value=!1},comments:_,comment:u,attachments:n,fileChange:h=>{let r=h.target.files;r&&r.length?n.value=r:n.value=[]}}}},L=t=>(E("data-v-c38eae53"),t=t(),j(),t),Lt={class:"task-show"},Mt={class:"top-part"},At={key:0,class:"mt-3"},It=L(()=>o("h1",null,"Right Info",-1)),$t={class:"description"},St=L(()=>o("b",null,"Description:",-1)),Rt=["innerHTML"],Bt={class:"comment-layout",id:"commentLayout"},Dt={class:"row"},Ft=L(()=>o("div",{class:"flex sm12 mb-3"},[o("div",{class:"comment-list",id:"commentListRoot"})],-1)),Nt={class:"flex sm12"},qt=L(()=>o("span",null,"Send",-1));function Tt(t,s,p,e,_,c){const u=m("show-attachment"),n=m("va-button"),f=m("el-input"),l=m("el-form-item"),C=m("el-col"),M=m("el-row"),S=m("arrow-right-bold"),h=m("el-icon"),r=m("el-button"),v=m("el-form"),V=m("el-card"),k=et("loading");return y(),b("div",Lt,[i(u,{attachments:e.task.attachments,show:e.showAttachModal,"onUpdate:show":s[0]||(s[0]=w=>e.showAttachModal=w)},null,8,["attachments","show"]),o("div",Mt,[o("div",null,[o("h1",null,A(e.task.title),1),e.task.attachments.length?(y(),b("div",At,[i(n,{preset:"primary",icon:"file_present",onClick:s[1]||(s[1]=w=>e.showAttachModal=!0)},{default:d(()=>[x("Show Attachments")]),_:1})])):X("",!0)]),Y(t.$slots,"default",{},()=>[It],!0)]),o("div",$t,[St,x(),o("span",{innerHTML:e.task.description},null,8,Rt)]),o("div",Bt,[o("div",Dt,[Ft,o("div",Nt,[tt((y(),H(V,null,{default:d(()=>[i(v,{"label-position":"top"},{default:d(()=>[i(l,{label:"Comment",prop:"desc"},{default:d(()=>[i(f,{type:"textarea",modelValue:e.comment,"onUpdate:modelValue":s[2]||(s[2]=w=>e.comment=w)},null,8,["modelValue"])]),_:1}),i(M,{gutter:24},{default:d(()=>[i(C,{sm:18,md:18,style:{"text-align":"center"}},{default:d(()=>[i(M,{gutter:24},{default:d(()=>[i(C,{span:24},{default:d(()=>[o("div",null,[o("input",{type:"file",multiple:"",onChange:s[3]||(s[3]=(...w)=>e.fileChange&&e.fileChange(...w))},null,32)])]),_:1}),(y(!0),b(U,null,T(e.attachments,(w,z)=>(y(),H(C,{span:24,key:z},{default:d(()=>[x(A(w.name),1)]),_:2},1024))),128))]),_:1})]),_:1}),i(C,{sm:6,md:6,style:{"text-align":"right"}},{default:d(()=>[i(r,{type:"primary",onClick:e.addComment},{default:d(()=>[i(h,null,{default:d(()=>[i(S)]),_:1}),qt]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})),[[k,e.commentBusy]])])])])])}const Kt=$(Ht,[["render",Tt],["__scopeId","data-v-c38eae53"]]);export{Kt as S};
