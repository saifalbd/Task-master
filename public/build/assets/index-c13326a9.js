import{a as q}from"./app-layout-ddd4ecde.js";import{_ as E}from"./PageTitleBox-3291f9d9.js";import{F as T}from"./FormDialog-0d177dd5.js";import{r as R}from"./index-810449cf.js";import"./moment-fbc5633a.js";import{_ as L,r as y,f as w,h as S,w as h,b as _,i as e,e as u,d as B,j as b,c as V,p as z,F as P,K as Z,t as F,q as N,s as D,ae as k,af as O,ag as a,M as G,J,H as A}from"./app-15300521.js";import{m as $}from"./icon-7c2f508c.js";import{C as I}from"./index-3f9f24ef.js";import{u as K}from"./useToast-c3bf6ae8.js";const Q={components:{FormDialog:T},props:{show:{type:Boolean,default:!1},taskId:{type:Number,required:!0},parent:{type:Object,required:!0}},setup(t,{emit:s}){let m=y(!1);const o=y(null);let i=y("");return{props:t,form:o,emit:s,save:async()=>{if(route("task.store"),!await o.value.validate())return null;try{const l=new FormData,v=route("comment.store");l.append("model_id",t.taskId),l.append("model_type","task"),l.append("parent_id",t.parent.id),l.append("text",i.value);const{data:r}=await axios.post(v,l);i.value="",s("update:show",!1)}catch(l){console.error(l),validErorrs(l)}},rs:R,busy:m,text:i}}},W={class:"layout gutter--md"},X={class:"row align-content--center"},Y={class:"flex xs12 in-box"};function tt(t,s,m,o,i,n){const p=u("va-input"),l=u("va-form"),v=u("form-dialog");return w(),S(v,{show:o.props.show,"onUpdate:show":s[1]||(s[1]=r=>o.emit("update:show",r)),busy:o.busy,title:"Replay",onAdd:o.save,fullscreen:!1},{default:h(()=>[_(l,{ref:"form"},{default:h(()=>[e("div",W,[e("div",X,[e("div",Y,[_(p,{modelValue:o.text,"onUpdate:modelValue":s[0]||(s[0]=r=>o.text=r),label:"Replay",type:"textarea",placeholder:"Commnet Here",rules:o.rs("Replay",!0)},null,8,["modelValue","rules"])])])])]),_:1},512)]),_:1},8,["show","busy","onAdd"])}const j=L(Q,[["render",tt]]);const et=B({props:{show:{type:Boolean,default:!1},attachments:{type:Array,default(){return[]}}},setup(t,{emit:s}){return{props:t,close:()=>{s("update:show",!1)}}}}),ot=t=>(N("data-v-6fa429a1"),t=t(),D(),t),st={class:"layout va-gutter-1"},at={class:"row"},nt={class:"flex xs12"},lt={class:"item mb-4"},rt={class:"form-title"},ct=ot(()=>e("span",{class:"text"},"Attachments",-1)),it={class:"flex xs12"},dt={class:"item"},mt={class:"row"},_t=["src","alt"],ut={key:1},pt=["href"],ht={class:"flex xs12"},vt={class:"item actions-btns"};function ft(t,s,m,o,i,n){const p=u("va-icon"),l=u("va-button"),v=u("va-modal");return w(),S(v,{modelValue:t.show,"onUpdate:modelValue":s[0]||(s[0]=r=>t.show=r),fullscreen:!1,"hide-default-actions":"","no-outside-dismiss":""},{default:h(()=>[e("div",st,[e("div",at,[e("div",nt,[e("div",lt,[e("div",rt,[_(p,{class:"material-icons"},{default:h(()=>[b("file_present")]),_:1}),ct])])]),e("div",it,[e("div",dt,[e("div",mt,[(w(!0),V(P,null,z(t.props.attachments,r=>(w(),V("div",{class:"flex sm12",key:r.id},[r.isImg?(w(),V("div",{key:0,class:Z({is_img:r.isImg})},[e("img",{src:r.url,alt:r.path},null,8,_t)],2)):(w(),V("div",ut,[e("a",{href:r.url},F(r.path),9,pt)]))]))),128))])])]),e("div",ht,[e("div",vt,[_(l,{color:"danger",size:"small",onClick:t.close},{default:h(()=>[_(p,{class:"material-icons"},{default:h(()=>[b("close")]),_:1}),b(" Close")]),_:1},8,["onClick"])])])])])]),_:1},8,["modelValue"])}const H=L(et,[["render",ft],["__scopeId","data-v-6fa429a1"]]),yt=B({components:{VaAvatar:k,AddReplay:j,VaButtonGroup:O,ShowAttachment:H},props:{taskId:{type:Number,required:!0},comments:{type:Array,required:!0}},setup(t){return{props:t,remove:async(m,o)=>{try{const i=route("comment.destroy",{comment:m});await axios.delete(i);const n=o.findIndex(p=>p.id==m);n>-1&&o.splice(n,1)}catch(i){console.error(i)}}}},methods:{icon(t){let s=18;return a("svg",{style:`width:${s}px;height:${s}px`,viewBox:"0 0 24 24"},[a("path",{fill:"currentColor",d:t})])},commentItemField(t,s){var i;let m=a("div");return t.replayes.length&&(m=a("div",{class:"comment-list"},t.replayes.map(n=>this.commentItemField(n,n.replayes)))),a("div",{class:"comment-list-item"},[a("div",{class:"inner"},[a("div",{},[a(k,{src:"https://randomuser.me/api/portraits/women/5.jpg"})]),a("div",{class:"text-box"},[a("p",{},[a("b",{},t.user.name),a("small",t.atNow)]),a("p",{},t.text)])]),a("div",{class:"action-bar"},[a(j,{show:t.showReplay,parent:t,taskId:this.props.taskId,"onUpdate:show":n=>{t.showReplay=n},onPush:n=>{t.replayes.push(n),t.showReplay=!1}}),a("div",{class:"action-bar-inner"},[a("div",{class:"action-list"},[a("button",{class:"like-btn"},[this.icon("M5,9V21H1V9H5M9,21A2,2 0 0,1 7,19V9C7,8.45 7.22,7.95 7.59,7.59L14.17,1L15.23,2.06C15.5,2.33 15.67,2.7 15.67,3.11L15.64,3.43L14.69,8H21C22.11,8 23,8.9 23,10V12C23,12.26 22.95,12.5 22.86,12.73L19.84,19.78C19.54,20.5 18.83,21 18,21H9M9,19H18.03L21,12V10H12.21L13.34,4.68L9,9.03V19Z")]),a("button",{class:"replay-btn",onClick:()=>{t.showReplay=!0}},[this.icon("M11,9.8V10.7L12.7,10.9C15.3,11.3 17.2,12.3 18.6,13.6C16.9,13.1 15.1,12.8 13,12.8H11V14.1L8.8,12L11,9.8M13,5L6,12L13,19V14.9C18,14.9 21.5,16.5 24,20C23,15 20,10 13,9M7,8V5L0,12L7,19V16L3,12"),"Replay"]),a("button",{class:"remove-btn",onClick:()=>{this.remove(t.id,s)}},[this.icon("M4 19V7H16V19C16 20.1 15.1 21 14 21H6C4.9 21 4 20.1 4 19M6 9V19H14V9H6M13.5 4H17V6H3V4H6.5L7.5 3H12.5L13.5 4M19 17V15H21V17H19M19 13V7H21V13H19Z"),"Remove"])]),(i=t.attachments)!=null&&i.length?a("div",{},[a(H,{attachments:t.attachments,show:t.showAttachModal,"onUpdate:show":n=>{t.showAttachModal=n}}),a("button",{class:"show-attach-btn",onClick:()=>{t.showAttachModal=!0}},[this.icon("M4 19V7H16V19C16 20.1 15.1 21 14 21H6C4.9 21 4 20.1 4 19M6 9V19H14V9H6M13.5 4H17V6H3V4H6.5L7.5 3H12.5L13.5 4M19 17V15H21V17H19M19 13V7H21V13H19Z"),"Show Attach"])]):a("div")])]),m])}},render(){return a("div",{class:"comment-list"},this.props.comments.map(t=>this.commentItemField(t,this.props.comments)))}});const wt={props:{auth_id:{type:Number,required:!0},id:{type:[String,Number],required:!0},project:{type:Object,required:!0}},components:{AppLayout:q,PageTitleBox:E,Comments:yt,ShowAttachment:H},setup(t){const{init:s}=K(),m=y(t.project),o=y([]),i=y(!1),n=y(""),p=y([]),l=y(!1),v=async f=>{try{const d=route("comment.index",{model_type:"project",model_id:t.id}),{data:c}=await axios.get(d);c.forEach(x=>{let g={comment:x,model_type:"project",model_id:t.id,auth_id:t.auth_id},U=new I(g);$(f,U)})}catch(d){console.error(d)}},r=f=>{try{window.Echo.join(`comment.project.${t.id}`).listen("NewComment",d=>{let c={comment:d,model_type:"project",model_id:t.id,auth_id:t.auth_id},x=new I(c);$(f,x),console.log("comment:"+d.text)})}catch(d){console.log(d)}};return G(()=>{let f=document.getElementById("commentListRoot");v(f),r(f)}),{rs:R,showAttachModal:i,commentBusy:l,project:m,addComment:async()=>{if(!n.value)return null;l.value=!0;try{const d=route("comment.store"),c=new FormData;c.append("model_id",t.id),c.append("model_type","project"),c.append("text",n.value),p.value.forEach((x,g)=>{c.append(`attachments[${g}]`,x)}),await axios.post(d,c),n.value="",s({message:"Succsess Fully Add Comment",color:"#432c50",closeable:!0,duration:2e3}),form.value.reset()}catch(d){console.error(d)}l.value=!1},comments:o,comment:n,attachments:p}}},C=t=>(N("data-v-56818ca6"),t=t(),D(),t),Vt={class:"task-show"},xt={class:"top-part"},bt={key:0,class:"mt-3"},Ct=C(()=>e("h1",null,"Right Info",-1)),gt={class:"description"},Ht=C(()=>e("b",null,"Description:",-1)),Lt=["innerHTML"],Mt={class:"comment-layout",id:"commentLayout"},kt={class:"row"},At={class:"flex sm12 mb-3"},$t=C(()=>e("div",{class:"flex sm12 mb-3"},[e("div",{class:"comment-list",id:"commentListRoot"})],-1)),It={class:"flex sm12"},jt={class:"textarea-bottom"},Rt={class:"left-side"},St={class:"right"},Bt=C(()=>e("span",{class:"ml-2"},"Add Comment",-1));function Ft(t,s,m,o,i,n){const p=u("show-attachment"),l=u("va-button"),v=u("va-input"),r=u("va-file-upload"),M=u("va-icon"),f=u("va-form"),d=u("va-inner-loading");return w(),V("div",Vt,[_(p,{attachments:o.project.attachments,show:o.showAttachModal,"onUpdate:show":s[0]||(s[0]=c=>o.showAttachModal=c)},null,8,["attachments","show"]),e("div",xt,[e("div",null,[e("h1",null,F(o.project.title),1),o.project.attachments.length?(w(),V("div",bt,[_(l,{preset:"primary",icon:"file_present",onClick:s[1]||(s[1]=c=>o.showAttachModal=!0)},{default:h(()=>[b("Show Attachments")]),_:1})])):J("",!0)]),A(t.$slots,"default",{},()=>[Ct],!0)]),e("div",gt,[Ht,b(),e("span",{innerHTML:o.project.description},null,8,Lt)]),e("div",Mt,[e("div",kt,[e("div",At,[A(t.$slots,"tasks",{},void 0,!0)]),$t,e("div",It,[_(d,{loading:o.commentBusy},{default:h(()=>[_(f,{class:"comment-form"},{default:h(()=>[_(v,{modelValue:o.comment,"onUpdate:modelValue":s[2]||(s[2]=c=>o.comment=c),type:"textarea",label:"Comments","min-rows":3,"max-rows":5,rules:o.rs("comment",!0)},null,8,["modelValue","rules"]),e("div",jt,[e("div",Rt,[_(r,{class:"small","upload-button-text":"Upload Attachment",modelValue:o.attachments,"onUpdate:modelValue":s[3]||(s[3]=c=>o.attachments=c),dropzone:""},null,8,["modelValue"])]),e("div",St,[_(l,{preset:"secondary","border-color":"primary",onClick:o.addComment},{default:h(()=>[_(M,{name:"comment"}),Bt]),_:1},8,["onClick"])])])]),_:1})]),_:1},8,["loading"])])])])])}const Ot=L(wt,[["render",Ft],["__scopeId","data-v-56818ca6"]]);export{Ot as S};
